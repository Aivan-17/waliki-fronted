{"ast":null,"code":"import _toConsumableArray from \"/home/ivan/Documentos/Waliki/waliki-fronted/node_modules/@babel/runtime/helpers/esm/toConsumableArray\";\nimport _createForOfIteratorHelper from \"/home/ivan/Documentos/Waliki/waliki-fronted/node_modules/@babel/runtime/helpers/esm/createForOfIteratorHelper\";\nimport _classCallCheck from \"/home/ivan/Documentos/Waliki/waliki-fronted/node_modules/@babel/runtime/helpers/esm/classCallCheck\";\nimport _createClass from \"/home/ivan/Documentos/Waliki/waliki-fronted/node_modules/@babel/runtime/helpers/esm/createClass\";\nimport _regeneratorRuntime from \"/home/ivan/Documentos/Waliki/waliki-fronted/node_modules/@babel/runtime/regenerator\";\nimport { __awaiter } from 'tslib';\nimport { Injectable, NgModule } from '@angular/core';\nimport { HttpHeaders, HTTP_INTERCEPTORS } from '@angular/common/http';\nimport { Subject, from } from 'rxjs';\nimport { map, mergeMap } from 'rxjs/operators';\nimport * as Keycloak_ from 'keycloak-js';\nimport { CommonModule } from '@angular/common';\nimport * as ɵngcc0 from '@angular/core';\nvar KeycloakEventType;\n\n(function (KeycloakEventType) {\n  KeycloakEventType[KeycloakEventType[\"OnAuthError\"] = 0] = \"OnAuthError\";\n  KeycloakEventType[KeycloakEventType[\"OnAuthLogout\"] = 1] = \"OnAuthLogout\";\n  KeycloakEventType[KeycloakEventType[\"OnAuthRefreshError\"] = 2] = \"OnAuthRefreshError\";\n  KeycloakEventType[KeycloakEventType[\"OnAuthRefreshSuccess\"] = 3] = \"OnAuthRefreshSuccess\";\n  KeycloakEventType[KeycloakEventType[\"OnAuthSuccess\"] = 4] = \"OnAuthSuccess\";\n  KeycloakEventType[KeycloakEventType[\"OnReady\"] = 5] = \"OnReady\";\n  KeycloakEventType[KeycloakEventType[\"OnTokenExpired\"] = 6] = \"OnTokenExpired\";\n})(KeycloakEventType || (KeycloakEventType = {}));\n\nvar KeycloakAuthGuard = /*#__PURE__*/function () {\n  function KeycloakAuthGuard(router, keycloakAngular) {\n    _classCallCheck(this, KeycloakAuthGuard);\n\n    this.router = router;\n    this.keycloakAngular = keycloakAngular;\n  }\n\n  _createClass(KeycloakAuthGuard, [{\n    key: \"canActivate\",\n    value: function canActivate(route, state) {\n      var _this = this;\n\n      return new Promise(function (resolve, reject) {\n        return __awaiter(_this, void 0, void 0, /*#__PURE__*/_regeneratorRuntime.mark(function _callee() {\n          var result;\n          return _regeneratorRuntime.wrap(function _callee$(_context) {\n            while (1) {\n              switch (_context.prev = _context.next) {\n                case 0:\n                  _context.prev = 0;\n                  _context.next = 3;\n                  return this.keycloakAngular.isLoggedIn();\n\n                case 3:\n                  this.authenticated = _context.sent;\n                  _context.next = 6;\n                  return this.keycloakAngular.getUserRoles(true);\n\n                case 6:\n                  this.roles = _context.sent;\n                  _context.next = 9;\n                  return this.isAccessAllowed(route, state);\n\n                case 9:\n                  result = _context.sent;\n                  resolve(result);\n                  _context.next = 16;\n                  break;\n\n                case 13:\n                  _context.prev = 13;\n                  _context.t0 = _context[\"catch\"](0);\n                  reject('An error happened during access validation. Details:' + _context.t0);\n\n                case 16:\n                case \"end\":\n                  return _context.stop();\n              }\n            }\n          }, _callee, this, [[0, 13]]);\n        }));\n      });\n    }\n  }]);\n\n  return KeycloakAuthGuard;\n}();\n\nvar Keycloak = Keycloak_;\n\nvar KeycloakService = /*#__PURE__*/function () {\n  function KeycloakService() {\n    _classCallCheck(this, KeycloakService);\n\n    this._keycloakEvents$ = new Subject();\n  }\n\n  _createClass(KeycloakService, [{\n    key: \"bindsKeycloakEvents\",\n    value: function bindsKeycloakEvents() {\n      var _this2 = this;\n\n      this._instance.onAuthError = function (errorData) {\n        _this2._keycloakEvents$.next({\n          args: errorData,\n          type: KeycloakEventType.OnAuthError\n        });\n      };\n\n      this._instance.onAuthLogout = function () {\n        _this2._keycloakEvents$.next({\n          type: KeycloakEventType.OnAuthLogout\n        });\n      };\n\n      this._instance.onAuthRefreshSuccess = function () {\n        _this2._keycloakEvents$.next({\n          type: KeycloakEventType.OnAuthRefreshSuccess\n        });\n      };\n\n      this._instance.onAuthRefreshError = function () {\n        _this2._keycloakEvents$.next({\n          type: KeycloakEventType.OnAuthRefreshError\n        });\n      };\n\n      this._instance.onAuthSuccess = function () {\n        _this2._keycloakEvents$.next({\n          type: KeycloakEventType.OnAuthSuccess\n        });\n      };\n\n      this._instance.onTokenExpired = function () {\n        _this2._keycloakEvents$.next({\n          type: KeycloakEventType.OnTokenExpired\n        });\n      };\n\n      this._instance.onReady = function (authenticated) {\n        _this2._keycloakEvents$.next({\n          args: authenticated,\n          type: KeycloakEventType.OnReady\n        });\n      };\n    }\n  }, {\n    key: \"loadExcludedUrls\",\n    value: function loadExcludedUrls(bearerExcludedUrls) {\n      var excludedUrls = [];\n\n      var _iterator = _createForOfIteratorHelper(bearerExcludedUrls),\n          _step;\n\n      try {\n        for (_iterator.s(); !(_step = _iterator.n()).done;) {\n          var item = _step.value;\n          var excludedUrl = void 0;\n\n          if (typeof item === 'string') {\n            excludedUrl = {\n              urlPattern: new RegExp(item, 'i'),\n              httpMethods: []\n            };\n          } else {\n            excludedUrl = {\n              urlPattern: new RegExp(item.url, 'i'),\n              httpMethods: item.httpMethods\n            };\n          }\n\n          excludedUrls.push(excludedUrl);\n        }\n      } catch (err) {\n        _iterator.e(err);\n      } finally {\n        _iterator.f();\n      }\n\n      return excludedUrls;\n    }\n  }, {\n    key: \"initServiceValues\",\n    value: function initServiceValues(_ref) {\n      var _ref$enableBearerInte = _ref.enableBearerInterceptor,\n          enableBearerInterceptor = _ref$enableBearerInte === void 0 ? true : _ref$enableBearerInte,\n          _ref$loadUserProfileA = _ref.loadUserProfileAtStartUp,\n          loadUserProfileAtStartUp = _ref$loadUserProfileA === void 0 ? false : _ref$loadUserProfileA,\n          _ref$bearerExcludedUr = _ref.bearerExcludedUrls,\n          bearerExcludedUrls = _ref$bearerExcludedUr === void 0 ? [] : _ref$bearerExcludedUr,\n          _ref$authorizationHea = _ref.authorizationHeaderName,\n          authorizationHeaderName = _ref$authorizationHea === void 0 ? 'Authorization' : _ref$authorizationHea,\n          _ref$bearerPrefix = _ref.bearerPrefix,\n          bearerPrefix = _ref$bearerPrefix === void 0 ? 'Bearer' : _ref$bearerPrefix,\n          initOptions = _ref.initOptions;\n      this._enableBearerInterceptor = enableBearerInterceptor;\n      this._loadUserProfileAtStartUp = loadUserProfileAtStartUp;\n      this._authorizationHeaderName = authorizationHeaderName;\n      this._bearerPrefix = bearerPrefix.trim().concat(' ');\n      this._excludedUrls = this.loadExcludedUrls(bearerExcludedUrls);\n      this._silentRefresh = initOptions ? initOptions.flow === 'implicit' : false;\n    }\n  }, {\n    key: \"init\",\n    value: function init() {\n      var options = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : {};\n      return __awaiter(this, void 0, void 0, /*#__PURE__*/_regeneratorRuntime.mark(function _callee2() {\n        var config, initOptions, authenticated;\n        return _regeneratorRuntime.wrap(function _callee2$(_context2) {\n          while (1) {\n            switch (_context2.prev = _context2.next) {\n              case 0:\n                this.initServiceValues(options);\n                config = options.config, initOptions = options.initOptions;\n                this._instance = Keycloak(config);\n                this.bindsKeycloakEvents();\n                _context2.next = 6;\n                return this._instance.init(initOptions);\n\n              case 6:\n                authenticated = _context2.sent;\n\n                if (!(authenticated && this._loadUserProfileAtStartUp)) {\n                  _context2.next = 10;\n                  break;\n                }\n\n                _context2.next = 10;\n                return this.loadUserProfile();\n\n              case 10:\n                return _context2.abrupt(\"return\", authenticated);\n\n              case 11:\n              case \"end\":\n                return _context2.stop();\n            }\n          }\n        }, _callee2, this);\n      }));\n    }\n  }, {\n    key: \"login\",\n    value: function login() {\n      var options = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : {};\n      return __awaiter(this, void 0, void 0, /*#__PURE__*/_regeneratorRuntime.mark(function _callee3() {\n        return _regeneratorRuntime.wrap(function _callee3$(_context3) {\n          while (1) {\n            switch (_context3.prev = _context3.next) {\n              case 0:\n                _context3.next = 2;\n                return this._instance.login(options);\n\n              case 2:\n                if (!this._loadUserProfileAtStartUp) {\n                  _context3.next = 5;\n                  break;\n                }\n\n                _context3.next = 5;\n                return this.loadUserProfile();\n\n              case 5:\n              case \"end\":\n                return _context3.stop();\n            }\n          }\n        }, _callee3, this);\n      }));\n    }\n  }, {\n    key: \"logout\",\n    value: function logout(redirectUri) {\n      return __awaiter(this, void 0, void 0, /*#__PURE__*/_regeneratorRuntime.mark(function _callee4() {\n        var options;\n        return _regeneratorRuntime.wrap(function _callee4$(_context4) {\n          while (1) {\n            switch (_context4.prev = _context4.next) {\n              case 0:\n                options = {\n                  redirectUri: redirectUri\n                };\n                _context4.next = 3;\n                return this._instance.logout(options);\n\n              case 3:\n                this._userProfile = undefined;\n\n              case 4:\n              case \"end\":\n                return _context4.stop();\n            }\n          }\n        }, _callee4, this);\n      }));\n    }\n  }, {\n    key: \"register\",\n    value: function register() {\n      var options = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : {\n        action: 'register'\n      };\n      return __awaiter(this, void 0, void 0, /*#__PURE__*/_regeneratorRuntime.mark(function _callee5() {\n        return _regeneratorRuntime.wrap(function _callee5$(_context5) {\n          while (1) {\n            switch (_context5.prev = _context5.next) {\n              case 0:\n                _context5.next = 2;\n                return this._instance.register(options);\n\n              case 2:\n              case \"end\":\n                return _context5.stop();\n            }\n          }\n        }, _callee5, this);\n      }));\n    }\n  }, {\n    key: \"isUserInRole\",\n    value: function isUserInRole(role, resource) {\n      var hasRole;\n      hasRole = this._instance.hasResourceRole(role, resource);\n\n      if (!hasRole) {\n        hasRole = this._instance.hasRealmRole(role);\n      }\n\n      return hasRole;\n    }\n  }, {\n    key: \"getUserRoles\",\n    value: function getUserRoles() {\n      var allRoles = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : true;\n      var roles = [];\n\n      if (this._instance.resourceAccess) {\n        for (var key in this._instance.resourceAccess) {\n          if (this._instance.resourceAccess.hasOwnProperty(key)) {\n            var resourceAccess = this._instance.resourceAccess[key];\n            var clientRoles = resourceAccess['roles'] || [];\n            roles = roles.concat(clientRoles);\n          }\n        }\n      }\n\n      if (allRoles && this._instance.realmAccess) {\n        var _roles;\n\n        var realmRoles = this._instance.realmAccess['roles'] || [];\n\n        (_roles = roles).push.apply(_roles, _toConsumableArray(realmRoles));\n      }\n\n      return roles;\n    }\n  }, {\n    key: \"isLoggedIn\",\n    value: function isLoggedIn() {\n      return __awaiter(this, void 0, void 0, /*#__PURE__*/_regeneratorRuntime.mark(function _callee6() {\n        return _regeneratorRuntime.wrap(function _callee6$(_context6) {\n          while (1) {\n            switch (_context6.prev = _context6.next) {\n              case 0:\n                _context6.prev = 0;\n\n                if (this._instance.authenticated) {\n                  _context6.next = 3;\n                  break;\n                }\n\n                return _context6.abrupt(\"return\", false);\n\n              case 3:\n                _context6.next = 5;\n                return this.updateToken(20);\n\n              case 5:\n                return _context6.abrupt(\"return\", true);\n\n              case 8:\n                _context6.prev = 8;\n                _context6.t0 = _context6[\"catch\"](0);\n                return _context6.abrupt(\"return\", false);\n\n              case 11:\n              case \"end\":\n                return _context6.stop();\n            }\n          }\n        }, _callee6, this, [[0, 8]]);\n      }));\n    }\n  }, {\n    key: \"isTokenExpired\",\n    value: function isTokenExpired() {\n      var minValidity = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : 0;\n      return this._instance.isTokenExpired(minValidity);\n    }\n  }, {\n    key: \"updateToken\",\n    value: function updateToken() {\n      var minValidity = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : 5;\n      return __awaiter(this, void 0, void 0, /*#__PURE__*/_regeneratorRuntime.mark(function _callee7() {\n        return _regeneratorRuntime.wrap(function _callee7$(_context7) {\n          while (1) {\n            switch (_context7.prev = _context7.next) {\n              case 0:\n                if (!this._silentRefresh) {\n                  _context7.next = 4;\n                  break;\n                }\n\n                if (!this.isTokenExpired()) {\n                  _context7.next = 3;\n                  break;\n                }\n\n                throw new Error('Failed to refresh the token, or the session is expired');\n\n              case 3:\n                return _context7.abrupt(\"return\", true);\n\n              case 4:\n                if (this._instance) {\n                  _context7.next = 6;\n                  break;\n                }\n\n                throw new Error('Keycloak Angular library is not initialized.');\n\n              case 6:\n                return _context7.abrupt(\"return\", this._instance.updateToken(minValidity));\n\n              case 7:\n              case \"end\":\n                return _context7.stop();\n            }\n          }\n        }, _callee7, this);\n      }));\n    }\n  }, {\n    key: \"loadUserProfile\",\n    value: function loadUserProfile() {\n      var forceReload = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : false;\n      return __awaiter(this, void 0, void 0, /*#__PURE__*/_regeneratorRuntime.mark(function _callee8() {\n        return _regeneratorRuntime.wrap(function _callee8$(_context8) {\n          while (1) {\n            switch (_context8.prev = _context8.next) {\n              case 0:\n                if (!(this._userProfile && !forceReload)) {\n                  _context8.next = 2;\n                  break;\n                }\n\n                return _context8.abrupt(\"return\", this._userProfile);\n\n              case 2:\n                if (this._instance.authenticated) {\n                  _context8.next = 4;\n                  break;\n                }\n\n                throw new Error('The user profile was not loaded as the user is not logged in.');\n\n              case 4:\n                _context8.next = 6;\n                return this._instance.loadUserProfile();\n\n              case 6:\n                return _context8.abrupt(\"return\", this._userProfile = _context8.sent);\n\n              case 7:\n              case \"end\":\n                return _context8.stop();\n            }\n          }\n        }, _callee8, this);\n      }));\n    }\n  }, {\n    key: \"getToken\",\n    value: function getToken() {\n      return __awaiter(this, void 0, void 0, /*#__PURE__*/_regeneratorRuntime.mark(function _callee9() {\n        return _regeneratorRuntime.wrap(function _callee9$(_context9) {\n          while (1) {\n            switch (_context9.prev = _context9.next) {\n              case 0:\n                _context9.next = 2;\n                return this.updateToken(10);\n\n              case 2:\n                return _context9.abrupt(\"return\", this._instance.token);\n\n              case 3:\n              case \"end\":\n                return _context9.stop();\n            }\n          }\n        }, _callee9, this);\n      }));\n    }\n  }, {\n    key: \"getUsername\",\n    value: function getUsername() {\n      if (!this._userProfile) {\n        throw new Error('User not logged in or user profile was not loaded.');\n      }\n\n      return this._userProfile.username;\n    }\n  }, {\n    key: \"clearToken\",\n    value: function clearToken() {\n      this._instance.clearToken();\n    }\n  }, {\n    key: \"addTokenToHeader\",\n    value: function addTokenToHeader() {\n      var _this3 = this;\n\n      var headers = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : new HttpHeaders();\n      return from(this.getToken()).pipe(map(function (token) {\n        return token ? headers.set(_this3._authorizationHeaderName, _this3._bearerPrefix + token) : headers;\n      }));\n    }\n  }, {\n    key: \"getKeycloakInstance\",\n    value: function getKeycloakInstance() {\n      return this._instance;\n    }\n  }, {\n    key: \"excludedUrls\",\n    get: function get() {\n      return this._excludedUrls;\n    }\n  }, {\n    key: \"enableBearerInterceptor\",\n    get: function get() {\n      return this._enableBearerInterceptor;\n    }\n  }, {\n    key: \"keycloakEvents$\",\n    get: function get() {\n      return this._keycloakEvents$;\n    }\n  }]);\n\n  return KeycloakService;\n}();\n\nKeycloakService.ɵfac = function KeycloakService_Factory(t) {\n  return new (t || KeycloakService)();\n};\n\nKeycloakService.ɵprov = /*@__PURE__*/ɵngcc0.ɵɵdefineInjectable({\n  token: KeycloakService,\n  factory: KeycloakService.ɵfac\n});\n\n(function () {\n  (typeof ngDevMode === \"undefined\" || ngDevMode) && ɵngcc0.ɵsetClassMetadata(KeycloakService, [{\n    type: Injectable\n  }], function () {\n    return [];\n  }, null);\n})();\n\nvar KeycloakBearerInterceptor = /*#__PURE__*/function () {\n  function KeycloakBearerInterceptor(keycloak) {\n    _classCallCheck(this, KeycloakBearerInterceptor);\n\n    this.keycloak = keycloak;\n  }\n\n  _createClass(KeycloakBearerInterceptor, [{\n    key: \"isUrlExcluded\",\n    value: function isUrlExcluded(_ref2, _ref3) {\n      var method = _ref2.method,\n          url = _ref2.url;\n      var urlPattern = _ref3.urlPattern,\n          httpMethods = _ref3.httpMethods;\n      var httpTest = httpMethods.length === 0 || httpMethods.join().indexOf(method.toUpperCase()) > -1;\n      var urlTest = urlPattern.test(url);\n      return httpTest && urlTest;\n    }\n  }, {\n    key: \"intercept\",\n    value: function intercept(req, next) {\n      var _this4 = this;\n\n      var _this$keycloak = this.keycloak,\n          enableBearerInterceptor = _this$keycloak.enableBearerInterceptor,\n          excludedUrls = _this$keycloak.excludedUrls;\n\n      if (!enableBearerInterceptor) {\n        return next.handle(req);\n      }\n\n      var shallPass = excludedUrls.findIndex(function (item) {\n        return _this4.isUrlExcluded(req, item);\n      }) > -1;\n\n      if (shallPass) {\n        return next.handle(req);\n      }\n\n      return from(this.keycloak.isLoggedIn()).pipe(mergeMap(function (loggedIn) {\n        return loggedIn ? _this4.handleRequestWithTokenHeader(req, next) : next.handle(req);\n      }));\n    }\n  }, {\n    key: \"handleRequestWithTokenHeader\",\n    value: function handleRequestWithTokenHeader(req, next) {\n      return this.keycloak.addTokenToHeader(req.headers).pipe(mergeMap(function (headersWithBearer) {\n        var kcReq = req.clone({\n          headers: headersWithBearer\n        });\n        return next.handle(kcReq);\n      }));\n    }\n  }]);\n\n  return KeycloakBearerInterceptor;\n}();\n\nKeycloakBearerInterceptor.ɵfac = function KeycloakBearerInterceptor_Factory(t) {\n  return new (t || KeycloakBearerInterceptor)(ɵngcc0.ɵɵinject(KeycloakService));\n};\n\nKeycloakBearerInterceptor.ɵprov = /*@__PURE__*/ɵngcc0.ɵɵdefineInjectable({\n  token: KeycloakBearerInterceptor,\n  factory: KeycloakBearerInterceptor.ɵfac\n});\n\nKeycloakBearerInterceptor.ctorParameters = function () {\n  return [{\n    type: KeycloakService\n  }];\n};\n\n(function () {\n  (typeof ngDevMode === \"undefined\" || ngDevMode) && ɵngcc0.ɵsetClassMetadata(KeycloakBearerInterceptor, [{\n    type: Injectable\n  }], function () {\n    return [{\n      type: KeycloakService\n    }];\n  }, null);\n})();\n\nvar CoreModule = function CoreModule() {\n  _classCallCheck(this, CoreModule);\n};\n\nCoreModule.ɵfac = function CoreModule_Factory(t) {\n  return new (t || CoreModule)();\n};\n\nCoreModule.ɵmod = /*@__PURE__*/ɵngcc0.ɵɵdefineNgModule({\n  type: CoreModule\n});\nCoreModule.ɵinj = /*@__PURE__*/ɵngcc0.ɵɵdefineInjector({\n  providers: [KeycloakService, {\n    provide: HTTP_INTERCEPTORS,\n    useClass: KeycloakBearerInterceptor,\n    multi: true\n  }],\n  imports: [[CommonModule]]\n});\n\n(function () {\n  (typeof ngDevMode === \"undefined\" || ngDevMode) && ɵngcc0.ɵsetClassMetadata(CoreModule, [{\n    type: NgModule,\n    args: [{\n      imports: [CommonModule],\n      providers: [KeycloakService, {\n        provide: HTTP_INTERCEPTORS,\n        useClass: KeycloakBearerInterceptor,\n        multi: true\n      }]\n    }]\n  }], null, null);\n})();\n\n(function () {\n  (typeof ngJitMode === \"undefined\" || ngJitMode) && ɵngcc0.ɵɵsetNgModuleScope(CoreModule, {\n    imports: function imports() {\n      return [CommonModule];\n    }\n  });\n})();\n\nvar KeycloakAngularModule = function KeycloakAngularModule() {\n  _classCallCheck(this, KeycloakAngularModule);\n};\n\nKeycloakAngularModule.ɵfac = function KeycloakAngularModule_Factory(t) {\n  return new (t || KeycloakAngularModule)();\n};\n\nKeycloakAngularModule.ɵmod = /*@__PURE__*/ɵngcc0.ɵɵdefineNgModule({\n  type: KeycloakAngularModule\n});\nKeycloakAngularModule.ɵinj = /*@__PURE__*/ɵngcc0.ɵɵdefineInjector({\n  imports: [[CoreModule]]\n});\n\n(function () {\n  (typeof ngDevMode === \"undefined\" || ngDevMode) && ɵngcc0.ɵsetClassMetadata(KeycloakAngularModule, [{\n    type: NgModule,\n    args: [{\n      imports: [CoreModule]\n    }]\n  }], null, null);\n})();\n\n(function () {\n  (typeof ngJitMode === \"undefined\" || ngJitMode) && ɵngcc0.ɵɵsetNgModuleScope(KeycloakAngularModule, {\n    imports: [CoreModule]\n  });\n})();\n\nexport { CoreModule, KeycloakAngularModule, KeycloakAuthGuard, KeycloakBearerInterceptor, KeycloakEventType, KeycloakService }; //# sourceMappingURL=keycloak-angular.js.map","map":{"version":3,"sources":["/home/ivan/Documentos/Waliki/waliki-fronted/node_modules/keycloak-angular/__ivy_ngcc__/fesm2015/keycloak-angular.js"],"names":["__awaiter","Injectable","NgModule","HttpHeaders","HTTP_INTERCEPTORS","Subject","from","map","mergeMap","Keycloak_","CommonModule","ɵngcc0","KeycloakEventType","KeycloakAuthGuard","router","keycloakAngular","route","state","Promise","resolve","reject","isLoggedIn","authenticated","getUserRoles","roles","isAccessAllowed","result","Keycloak","KeycloakService","_keycloakEvents$","_instance","onAuthError","errorData","next","args","type","OnAuthError","onAuthLogout","OnAuthLogout","onAuthRefreshSuccess","OnAuthRefreshSuccess","onAuthRefreshError","OnAuthRefreshError","onAuthSuccess","OnAuthSuccess","onTokenExpired","OnTokenExpired","onReady","OnReady","bearerExcludedUrls","excludedUrls","item","excludedUrl","urlPattern","RegExp","httpMethods","url","push","enableBearerInterceptor","loadUserProfileAtStartUp","authorizationHeaderName","bearerPrefix","initOptions","_enableBearerInterceptor","_loadUserProfileAtStartUp","_authorizationHeaderName","_bearerPrefix","trim","concat","_excludedUrls","loadExcludedUrls","_silentRefresh","flow","options","initServiceValues","config","bindsKeycloakEvents","init","loadUserProfile","login","redirectUri","logout","_userProfile","undefined","action","register","role","resource","hasRole","hasResourceRole","hasRealmRole","allRoles","resourceAccess","key","hasOwnProperty","clientRoles","realmAccess","realmRoles","updateToken","minValidity","isTokenExpired","Error","forceReload","token","username","clearToken","headers","getToken","pipe","set","ɵfac","KeycloakService_Factory","t","ɵprov","ɵɵdefineInjectable","factory","ngDevMode","ɵsetClassMetadata","KeycloakBearerInterceptor","keycloak","method","httpTest","length","join","indexOf","toUpperCase","urlTest","test","req","handle","shallPass","findIndex","isUrlExcluded","loggedIn","handleRequestWithTokenHeader","addTokenToHeader","headersWithBearer","kcReq","clone","KeycloakBearerInterceptor_Factory","ɵɵinject","ctorParameters","CoreModule","CoreModule_Factory","ɵmod","ɵɵdefineNgModule","ɵinj","ɵɵdefineInjector","providers","provide","useClass","multi","imports","ngJitMode","ɵɵsetNgModuleScope","KeycloakAngularModule","KeycloakAngularModule_Factory"],"mappings":"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","sourcesContent":["import { __awaiter } from 'tslib';\nimport { Injectable, NgModule } from '@angular/core';\nimport { HttpHeaders, HTTP_INTERCEPTORS } from '@angular/common/http';\nimport { Subject, from } from 'rxjs';\nimport { map, mergeMap } from 'rxjs/operators';\nimport * as Keycloak_ from 'keycloak-js';\nimport { CommonModule } from '@angular/common';\n\nimport * as ɵngcc0 from '@angular/core';\nvar KeycloakEventType;\n(function (KeycloakEventType) {\n    KeycloakEventType[KeycloakEventType[\"OnAuthError\"] = 0] = \"OnAuthError\";\n    KeycloakEventType[KeycloakEventType[\"OnAuthLogout\"] = 1] = \"OnAuthLogout\";\n    KeycloakEventType[KeycloakEventType[\"OnAuthRefreshError\"] = 2] = \"OnAuthRefreshError\";\n    KeycloakEventType[KeycloakEventType[\"OnAuthRefreshSuccess\"] = 3] = \"OnAuthRefreshSuccess\";\n    KeycloakEventType[KeycloakEventType[\"OnAuthSuccess\"] = 4] = \"OnAuthSuccess\";\n    KeycloakEventType[KeycloakEventType[\"OnReady\"] = 5] = \"OnReady\";\n    KeycloakEventType[KeycloakEventType[\"OnTokenExpired\"] = 6] = \"OnTokenExpired\";\n})(KeycloakEventType || (KeycloakEventType = {}));\n\nclass KeycloakAuthGuard {\n    constructor(router, keycloakAngular) {\n        this.router = router;\n        this.keycloakAngular = keycloakAngular;\n    }\n    canActivate(route, state) {\n        return new Promise((resolve, reject) => __awaiter(this, void 0, void 0, function* () {\n            try {\n                this.authenticated = yield this.keycloakAngular.isLoggedIn();\n                this.roles = yield this.keycloakAngular.getUserRoles(true);\n                const result = yield this.isAccessAllowed(route, state);\n                resolve(result);\n            }\n            catch (error) {\n                reject('An error happened during access validation. Details:' + error);\n            }\n        }));\n    }\n}\n\nconst Keycloak = Keycloak_;\nclass KeycloakService {\n    constructor() {\n        this._keycloakEvents$ = new Subject();\n    }\n    bindsKeycloakEvents() {\n        this._instance.onAuthError = (errorData) => {\n            this._keycloakEvents$.next({\n                args: errorData,\n                type: KeycloakEventType.OnAuthError,\n            });\n        };\n        this._instance.onAuthLogout = () => {\n            this._keycloakEvents$.next({ type: KeycloakEventType.OnAuthLogout });\n        };\n        this._instance.onAuthRefreshSuccess = () => {\n            this._keycloakEvents$.next({\n                type: KeycloakEventType.OnAuthRefreshSuccess,\n            });\n        };\n        this._instance.onAuthRefreshError = () => {\n            this._keycloakEvents$.next({\n                type: KeycloakEventType.OnAuthRefreshError,\n            });\n        };\n        this._instance.onAuthSuccess = () => {\n            this._keycloakEvents$.next({ type: KeycloakEventType.OnAuthSuccess });\n        };\n        this._instance.onTokenExpired = () => {\n            this._keycloakEvents$.next({\n                type: KeycloakEventType.OnTokenExpired,\n            });\n        };\n        this._instance.onReady = (authenticated) => {\n            this._keycloakEvents$.next({\n                args: authenticated,\n                type: KeycloakEventType.OnReady,\n            });\n        };\n    }\n    loadExcludedUrls(bearerExcludedUrls) {\n        const excludedUrls = [];\n        for (const item of bearerExcludedUrls) {\n            let excludedUrl;\n            if (typeof item === 'string') {\n                excludedUrl = { urlPattern: new RegExp(item, 'i'), httpMethods: [] };\n            }\n            else {\n                excludedUrl = {\n                    urlPattern: new RegExp(item.url, 'i'),\n                    httpMethods: item.httpMethods,\n                };\n            }\n            excludedUrls.push(excludedUrl);\n        }\n        return excludedUrls;\n    }\n    initServiceValues({ enableBearerInterceptor = true, loadUserProfileAtStartUp = false, bearerExcludedUrls = [], authorizationHeaderName = 'Authorization', bearerPrefix = 'Bearer', initOptions, }) {\n        this._enableBearerInterceptor = enableBearerInterceptor;\n        this._loadUserProfileAtStartUp = loadUserProfileAtStartUp;\n        this._authorizationHeaderName = authorizationHeaderName;\n        this._bearerPrefix = bearerPrefix.trim().concat(' ');\n        this._excludedUrls = this.loadExcludedUrls(bearerExcludedUrls);\n        this._silentRefresh = initOptions ? initOptions.flow === 'implicit' : false;\n    }\n    init(options = {}) {\n        return __awaiter(this, void 0, void 0, function* () {\n            this.initServiceValues(options);\n            const { config, initOptions } = options;\n            this._instance = Keycloak(config);\n            this.bindsKeycloakEvents();\n            const authenticated = yield this._instance.init(initOptions);\n            if (authenticated && this._loadUserProfileAtStartUp) {\n                yield this.loadUserProfile();\n            }\n            return authenticated;\n        });\n    }\n    login(options = {}) {\n        return __awaiter(this, void 0, void 0, function* () {\n            yield this._instance.login(options);\n            if (this._loadUserProfileAtStartUp) {\n                yield this.loadUserProfile();\n            }\n        });\n    }\n    logout(redirectUri) {\n        return __awaiter(this, void 0, void 0, function* () {\n            const options = {\n                redirectUri,\n            };\n            yield this._instance.logout(options);\n            this._userProfile = undefined;\n        });\n    }\n    register(options = { action: 'register' }) {\n        return __awaiter(this, void 0, void 0, function* () {\n            yield this._instance.register(options);\n        });\n    }\n    isUserInRole(role, resource) {\n        let hasRole;\n        hasRole = this._instance.hasResourceRole(role, resource);\n        if (!hasRole) {\n            hasRole = this._instance.hasRealmRole(role);\n        }\n        return hasRole;\n    }\n    getUserRoles(allRoles = true) {\n        let roles = [];\n        if (this._instance.resourceAccess) {\n            for (const key in this._instance.resourceAccess) {\n                if (this._instance.resourceAccess.hasOwnProperty(key)) {\n                    const resourceAccess = this._instance.resourceAccess[key];\n                    const clientRoles = resourceAccess['roles'] || [];\n                    roles = roles.concat(clientRoles);\n                }\n            }\n        }\n        if (allRoles && this._instance.realmAccess) {\n            const realmRoles = this._instance.realmAccess['roles'] || [];\n            roles.push(...realmRoles);\n        }\n        return roles;\n    }\n    isLoggedIn() {\n        return __awaiter(this, void 0, void 0, function* () {\n            try {\n                if (!this._instance.authenticated) {\n                    return false;\n                }\n                yield this.updateToken(20);\n                return true;\n            }\n            catch (error) {\n                return false;\n            }\n        });\n    }\n    isTokenExpired(minValidity = 0) {\n        return this._instance.isTokenExpired(minValidity);\n    }\n    updateToken(minValidity = 5) {\n        return __awaiter(this, void 0, void 0, function* () {\n            if (this._silentRefresh) {\n                if (this.isTokenExpired()) {\n                    throw new Error('Failed to refresh the token, or the session is expired');\n                }\n                return true;\n            }\n            if (!this._instance) {\n                throw new Error('Keycloak Angular library is not initialized.');\n            }\n            return this._instance.updateToken(minValidity);\n        });\n    }\n    loadUserProfile(forceReload = false) {\n        return __awaiter(this, void 0, void 0, function* () {\n            if (this._userProfile && !forceReload) {\n                return this._userProfile;\n            }\n            if (!this._instance.authenticated) {\n                throw new Error('The user profile was not loaded as the user is not logged in.');\n            }\n            return this._userProfile = yield this._instance.loadUserProfile();\n        });\n    }\n    getToken() {\n        return __awaiter(this, void 0, void 0, function* () {\n            yield this.updateToken(10);\n            return this._instance.token;\n        });\n    }\n    getUsername() {\n        if (!this._userProfile) {\n            throw new Error('User not logged in or user profile was not loaded.');\n        }\n        return this._userProfile.username;\n    }\n    clearToken() {\n        this._instance.clearToken();\n    }\n    addTokenToHeader(headers = new HttpHeaders()) {\n        return from(this.getToken()).pipe(map((token) => token ? headers.set(this._authorizationHeaderName, this._bearerPrefix + token) : headers));\n    }\n    getKeycloakInstance() {\n        return this._instance;\n    }\n    get excludedUrls() {\n        return this._excludedUrls;\n    }\n    get enableBearerInterceptor() {\n        return this._enableBearerInterceptor;\n    }\n    get keycloakEvents$() {\n        return this._keycloakEvents$;\n    }\n}\nKeycloakService.ɵfac = function KeycloakService_Factory(t) { return new (t || KeycloakService)(); };\nKeycloakService.ɵprov = /*@__PURE__*/ ɵngcc0.ɵɵdefineInjectable({ token: KeycloakService, factory: KeycloakService.ɵfac });\n(function () { (typeof ngDevMode === \"undefined\" || ngDevMode) && ɵngcc0.ɵsetClassMetadata(KeycloakService, [{\n        type: Injectable\n    }], function () { return []; }, null); })();\n\nclass KeycloakBearerInterceptor {\n    constructor(keycloak) {\n        this.keycloak = keycloak;\n    }\n    isUrlExcluded({ method, url }, { urlPattern, httpMethods }) {\n        const httpTest = httpMethods.length === 0 ||\n            httpMethods.join().indexOf(method.toUpperCase()) > -1;\n        const urlTest = urlPattern.test(url);\n        return httpTest && urlTest;\n    }\n    intercept(req, next) {\n        const { enableBearerInterceptor, excludedUrls } = this.keycloak;\n        if (!enableBearerInterceptor) {\n            return next.handle(req);\n        }\n        const shallPass = excludedUrls.findIndex(item => this.isUrlExcluded(req, item)) > -1;\n        if (shallPass) {\n            return next.handle(req);\n        }\n        return from(this.keycloak.isLoggedIn()).pipe(mergeMap((loggedIn) => loggedIn\n            ? this.handleRequestWithTokenHeader(req, next)\n            : next.handle(req)));\n    }\n    handleRequestWithTokenHeader(req, next) {\n        return this.keycloak.addTokenToHeader(req.headers).pipe(mergeMap(headersWithBearer => {\n            const kcReq = req.clone({ headers: headersWithBearer });\n            return next.handle(kcReq);\n        }));\n    }\n}\nKeycloakBearerInterceptor.ɵfac = function KeycloakBearerInterceptor_Factory(t) { return new (t || KeycloakBearerInterceptor)(ɵngcc0.ɵɵinject(KeycloakService)); };\nKeycloakBearerInterceptor.ɵprov = /*@__PURE__*/ ɵngcc0.ɵɵdefineInjectable({ token: KeycloakBearerInterceptor, factory: KeycloakBearerInterceptor.ɵfac });\nKeycloakBearerInterceptor.ctorParameters = () => [\n    { type: KeycloakService }\n];\n(function () { (typeof ngDevMode === \"undefined\" || ngDevMode) && ɵngcc0.ɵsetClassMetadata(KeycloakBearerInterceptor, [{\n        type: Injectable\n    }], function () { return [{ type: KeycloakService }]; }, null); })();\n\nclass CoreModule {\n}\nCoreModule.ɵfac = function CoreModule_Factory(t) { return new (t || CoreModule)(); };\nCoreModule.ɵmod = /*@__PURE__*/ ɵngcc0.ɵɵdefineNgModule({ type: CoreModule });\nCoreModule.ɵinj = /*@__PURE__*/ ɵngcc0.ɵɵdefineInjector({ providers: [\n        KeycloakService,\n        {\n            provide: HTTP_INTERCEPTORS,\n            useClass: KeycloakBearerInterceptor,\n            multi: true\n        }\n    ], imports: [[CommonModule]] });\n(function () { (typeof ngDevMode === \"undefined\" || ngDevMode) && ɵngcc0.ɵsetClassMetadata(CoreModule, [{\n        type: NgModule,\n        args: [{\n                imports: [CommonModule],\n                providers: [\n                    KeycloakService,\n                    {\n                        provide: HTTP_INTERCEPTORS,\n                        useClass: KeycloakBearerInterceptor,\n                        multi: true\n                    }\n                ]\n            }]\n    }], null, null); })();\n(function () { (typeof ngJitMode === \"undefined\" || ngJitMode) && ɵngcc0.ɵɵsetNgModuleScope(CoreModule, { imports: function () { return [CommonModule]; } }); })();\n\nclass KeycloakAngularModule {\n}\nKeycloakAngularModule.ɵfac = function KeycloakAngularModule_Factory(t) { return new (t || KeycloakAngularModule)(); };\nKeycloakAngularModule.ɵmod = /*@__PURE__*/ ɵngcc0.ɵɵdefineNgModule({ type: KeycloakAngularModule });\nKeycloakAngularModule.ɵinj = /*@__PURE__*/ ɵngcc0.ɵɵdefineInjector({ imports: [[CoreModule]] });\n(function () { (typeof ngDevMode === \"undefined\" || ngDevMode) && ɵngcc0.ɵsetClassMetadata(KeycloakAngularModule, [{\n        type: NgModule,\n        args: [{\n                imports: [CoreModule]\n            }]\n    }], null, null); })();\n(function () { (typeof ngJitMode === \"undefined\" || ngJitMode) && ɵngcc0.ɵɵsetNgModuleScope(KeycloakAngularModule, { imports: [CoreModule] }); })();\n\nexport { CoreModule, KeycloakAngularModule, KeycloakAuthGuard, KeycloakBearerInterceptor, KeycloakEventType, KeycloakService };\n\n//# sourceMappingURL=keycloak-angular.js.map"]},"metadata":{},"sourceType":"module"}